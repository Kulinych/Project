Started by GitHub push by Kulinych
Obtained Jenkinsfile from git https://github.com/Kulinych/Project.git
[Pipeline] Start of Pipeline
[Pipeline] node
Running on Jenkins in /var/jenkins_home/workspace/project scm
[Pipeline] {
[Pipeline] stage
[Pipeline] { (Declarative: Checkout SCM)
[Pipeline] checkout
Selected Git installation does not exist. Using Default
The recommended git tool is: NONE
No credentials specified
Cloning the remote Git repository
Cloning repository https://github.com/Kulinych/Project.git
 > git init /var/jenkins_home/workspace/project scm # timeout=10
Fetching upstream changes from https://github.com/Kulinych/Project.git
 > git --version # timeout=10
 > git --version # 'git version 2.30.2'
 > git fetch --tags --force --progress -- https://github.com/Kulinych/Project.git +refs/heads/*:refs/remotes/origin/* # timeout=10
 > git config remote.origin.url https://github.com/Kulinych/Project.git # timeout=10
 > git config --add remote.origin.fetch +refs/heads/*:refs/remotes/origin/* # timeout=10
Avoid second fetch
 > git rev-parse refs/remotes/origin/master^{commit} # timeout=10
Checking out Revision f3eac1e141e6aaa5d214d8262ed2cf0f2e86570a (refs/remotes/origin/master)
 > git config core.sparsecheckout # timeout=10
 > git checkout -f f3eac1e141e6aaa5d214d8262ed2cf0f2e86570a # timeout=10
Commit message: "test helm fail"
 > git rev-list --no-walk a5792f5ea1c59183096b91182fca0456712e7e9f # timeout=10
[Pipeline] }
[Pipeline] // stage
[Pipeline] withEnv
[Pipeline] {
[Pipeline] withEnv
[Pipeline] {
[Pipeline] stage
[Pipeline] { (clone app)
[Pipeline] git
The recommended git tool is: NONE
No credentials specified
 > git rev-parse --resolve-git-dir /var/jenkins_home/workspace/project scm/.git # timeout=10
Fetching changes from the remote Git repository
 > git config remote.origin.url https://github.com/Kulinych/project.git # timeout=10
Fetching upstream changes from https://github.com/Kulinych/project.git
 > git --version # timeout=10
 > git --version # 'git version 2.30.2'
 > git fetch --tags --force --progress -- https://github.com/Kulinych/project.git +refs/heads/*:refs/remotes/origin/* # timeout=10
 > git rev-parse refs/remotes/origin/master^{commit} # timeout=10
Checking out Revision f3eac1e141e6aaa5d214d8262ed2cf0f2e86570a (refs/remotes/origin/master)
 > git config core.sparsecheckout # timeout=10
 > git checkout -f f3eac1e141e6aaa5d214d8262ed2cf0f2e86570a # timeout=10
 > git branch -a -v --no-abbrev # timeout=10
 > git checkout -b master f3eac1e141e6aaa5d214d8262ed2cf0f2e86570a # timeout=10
Commit message: "test helm fail"
 > git rev-list --no-walk a5792f5ea1c59183096b91182fca0456712e7e9f # timeout=10
[Pipeline] }
[Pipeline] // stage
[Pipeline] stage
[Pipeline] { (Show files)
[Pipeline] sh
+ ls -l
total 6
-rw-r--r-- 1 root root  164 Dec  2 20:40 Dockerfile
-rw-r--r-- 1 root root 1562 Dec  2 20:40 Jenkinsfile
-rw-r--r-- 1 root root 1084 Dec  2 20:40 LICENSE
-rw-r--r-- 1 root root   99 Dec  2 20:40 README.md
drwxr-xr-x 4 root root   11 Dec  2 20:40 accounts
drwxr-xr-x 3 root root    8 Dec  2 20:40 api
drwxr-xr-x 3 root root    5 Dec  2 20:40 helm-chart
-rw-r--r-- 1 root root  286 Dec  2 20:40 index.html
drwxr-xr-x 6 root root   13 Dec  2 20:40 lists
-rw-r--r-- 1 root root  251 Dec  2 20:40 manage.py
-rw-r--r-- 1 root root   86 Dec  2 20:40 requirements.txt
drwxr-xr-x 4 root root    8 Dec  2 20:40 todolist
[Pipeline] }
[Pipeline] // stage
[Pipeline] stage
[Pipeline] { (build container )
[Pipeline] script
[Pipeline] {
[Pipeline] isUnix
[Pipeline] sh
+ docker build -t kulinych/md-sa2-18-21:35 .
Sending build context to Docker daemon  292.9kB

Step 1/7 : FROM python:3-alpine
 ---> dd04d4f70e7c
Step 2/7 : WORKDIR /app
 ---> Using cache
 ---> 5e8a1b1cba8e
Step 3/7 : ADD . .
 ---> 7ad715e20c3e
Step 4/7 : RUN pip3 install -r requirements.txt
 ---> Running in cac2b1138901
Collecting asgiref==3.3.4
  Downloading asgiref-3.3.4-py3-none-any.whl (22 kB)
Collecting Django==3.2.5
  Downloading Django-3.2.5-py3-none-any.whl (7.9 MB)
Collecting djangorestframework==3.12.4
  Downloading djangorestframework-3.12.4-py3-none-any.whl (957 kB)
Collecting pytz==2021.1
  Downloading pytz-2021.1-py2.py3-none-any.whl (510 kB)
Collecting sqlparse==0.4.2
  Downloading sqlparse-0.4.2-py3-none-any.whl (42 kB)
Installing collected packages: sqlparse, pytz, asgiref, Django, djangorestframework
Successfully installed Django-3.2.5 asgiref-3.3.4 djangorestframework-3.12.4 pytz-2021.1 sqlparse-0.4.2
[91mWARNING: Running pip as the 'root' user can result in broken permissions and conflicting behaviour with the system package manager. It is recommended to use a virtual environment instead: https://pip.pypa.io/warnings/venv
[0m[91mWARNING: You are using pip version 21.2.4; however, version 21.3.1 is available.
You should consider upgrading via the '/usr/local/bin/python -m pip install --upgrade pip' command.
[0mRemoving intermediate container cac2b1138901
 ---> 33c9c3538e22
Step 5/7 : EXPOSE 8000
 ---> Running in d6217b2ce497
Removing intermediate container d6217b2ce497
 ---> 3f6d8ca74ebc
Step 6/7 : ENTRYPOINT [ "python3" ]
 ---> Running in 95354f0eda00
Removing intermediate container 95354f0eda00
 ---> 8f9874b69dbf
Step 7/7 : CMD [ "manage.py", "runserver", "0.0.0.0:8000" ]
 ---> Running in 52681ae010fc
Removing intermediate container 52681ae010fc
 ---> d2707c9f8b13
Successfully built d2707c9f8b13
Successfully tagged kulinych/md-sa2-18-21:35
[Pipeline] }
[Pipeline] // script
[Pipeline] }
[Pipeline] // stage
[Pipeline] stage
[Pipeline] { (Unit test)
[Pipeline] sh
+ docker run -t kulinych/md-sa2-18-21:35 manage.py test -v 2
Creating test database for alias 'default' ('file:memorydb_default?mode=memory&cache=shared')...
[36;1mOperations to perform:[0m
[1m  Synchronize unmigrated apps: [0mmessages, rest_framework, staticfiles, todolist
[1m  Apply all migrations: [0madmin, auth, contenttypes, lists, sessions
[36;1mSynchronizing apps without migrations:[0m
  Creating tables...
    Running deferred SQL...
[36;1mRunning migrations:[0m
  Applying contenttypes.0001_initial...[32;1m OK[0m
  Applying auth.0001_initial...[32;1m OK[0m
  Applying admin.0001_initial...[32;1m OK[0m
  Applying admin.0002_logentry_remove_auto_add...[32;1m OK[0m
  Applying admin.0003_logentry_add_action_flag_choices...[32;1m OK[0m
  Applying contenttypes.0002_remove_content_type_name...[32;1m OK[0m
  Applying auth.0002_alter_permission_name_max_length...[32;1m OK[0m
  Applying auth.0003_alter_user_email_max_length...[32;1m OK[0m
  Applying auth.0004_alter_user_username_opts...[32;1m OK[0m
  Applying auth.0005_alter_user_last_login_null...[32;1m OK[0m
  Applying auth.0006_require_contenttypes_0002...[32;1m OK[0m
  Applying auth.0007_alter_validators_add_error_messages...[32;1m OK[0m
  Applying auth.0008_alter_user_username_max_length...[32;1m OK[0m
  Applying auth.0009_alter_user_last_name_max_length...[32;1m OK[0m
  Applying auth.0010_alter_group_name_max_length...[32;1m OK[0m
  Applying auth.0011_update_proxy_permissions...[32;1m OK[0m
  Applying auth.0012_alter_user_first_name_max_length...[32;1m OK[0m
  Applying lists.0001_initial...[32;1m OK[0m
  Applying sessions.0001_initial...[32;1m OK[0m
System check identified no issues (0 silenced).
test_faulty_login (accounts.tests.AccountsTests) ... ok
test_faulty_register (accounts.tests.AccountsTests) ... ok
test_get_login (accounts.tests.AccountsTests) ... ok
test_get_register (accounts.tests.AccountsTests) ... ok
test_login (accounts.tests.AccountsTests) ... ok
test_login_with_non_existent_user (accounts.tests.AccountsTests) ... ok
test_login_with_wrong_password (accounts.tests.AccountsTests) ... ok
test_logout (accounts.tests.AccountsTests) ... ok
test_register (accounts.tests.AccountsTests) ... ok
test_empty_password (accounts.tests.LoginFormTests) ... ok
test_empty_username (accounts.tests.LoginFormTests) ... ok
test_no_password (accounts.tests.LoginFormTests) ... ok
test_no_username (accounts.tests.LoginFormTests) ... ok
test_too_long_password (accounts.tests.LoginFormTests) ... ok
test_too_long_username (accounts.tests.LoginFormTests) ... ok
test_invalid_email (accounts.tests.RegistrationFormTests) ... ok
test_non_matching_passwords (accounts.tests.RegistrationFormTests) ... ok
test_valid_input (accounts.tests.RegistrationFormTests) ... ok
test_create_todolist (api.tests.TodoListTests) ... ok
test_delete_todolist (api.tests.TodoListTests) ... ok
test_get_non_existent_todolist (api.tests.TodoListTests) ... ok
test_get_todolist (api.tests.TodoListTests) ... ok
test_get_when_not_logged_in (api.tests.TodoListTests) ... ok
test_post_for_anon_users (api.tests.TodoListTests) ... ok
test_put_todolist (api.tests.TodoListTests) ... ok
test_create_todo (api.tests.TodoTests) ... ok
test_delete_todo (api.tests.TodoTests) ... ok
test_get_non_existent_todo (api.tests.TodoTests) ... ok
test_get_todo (api.tests.TodoTests) ... ok
test_get_when_not_logged_in (api.tests.TodoTests) ... ok
test_post_for_anon_users (api.tests.TodoTests) ... ok
test_put_todo (api.tests.TodoTests) ... ok
test_put_todo_changing_status (api.tests.TodoTests) ... ok
test_get_user_if_admin (api.tests.UserTests) ... ok
test_get_user_if_not_admin (api.tests.UserTests) ... ok
test_post_on_read_only (api.tests.UserTests) ... ok
test_count_closed_todos (lists.tests.ListModelTests) ... ok
test_count_open_todos (lists.tests.ListModelTests) ... ok
test_count_todos (lists.tests.ListModelTests) ... ok
test_add_todo_to_index_page (lists.tests.ListTests) ... ok
test_add_todo_to_todolist_view (lists.tests.ListTests) ... ok
test_add_todolist_to_todolist_overview (lists.tests.ListTests) ... ok
test_get_index_page (lists.tests.ListTests) ... ok
test_get_todolist_overview (lists.tests.ListTests) ... ok
test_get_todolist_overview_redirect_when_not_logged_in (lists.tests.ListTests) ... ok
test_get_todolist_view (lists.tests.ListTests) ... ok
test_empty_description (lists.tests.TodoFormTests) ... ok
test_no_description (lists.tests.TodoFormTests) ... ok
test_too_title (lists.tests.TodoFormTests) ... ok
test_valid_input (lists.tests.TodoFormTests) ... ok
test_empty_title (lists.tests.TodoListFormTests) ... ok
test_no_title (lists.tests.TodoListFormTests) ... ok
test_too_long_title (lists.tests.TodoListFormTests) ... ok
test_valid_input (lists.tests.TodoListFormTests) ... ok

----------------------------------------------------------------------
Ran 54 tests in 17.782s

OK
Destroying test database for alias 'default' ('file:memorydb_default?mode=memory&cache=shared')...
[Pipeline] }
[Pipeline] // stage
[Pipeline] stage
[Pipeline] { (push build)
[Pipeline] script
[Pipeline] {
[Pipeline] withEnv
[Pipeline] {
[Pipeline] withDockerRegistry
$ docker login -u kulinych -p ******** https://index.docker.io/v1/
WARNING! Using --password via the CLI is insecure. Use --password-stdin.
WARNING! Your password will be stored unencrypted in /var/jenkins_home/workspace/project scm@tmp/a28fc4b5-7e16-44bd-b7ea-cb90c377b8ec/config.json.
Configure a credential helper to remove this warning. See
https://docs.docker.com/engine/reference/commandline/login/#credentials-store

Login Succeeded
[Pipeline] {
[Pipeline] isUnix
[Pipeline] sh
+ docker tag kulinych/md-sa2-18-21:35 kulinych/md-sa2-18-21:35
[Pipeline] isUnix
[Pipeline] sh
+ docker push kulinych/md-sa2-18-21:35
The push refers to repository [docker.io/kulinych/md-sa2-18-21]
f195af9aac4f: Preparing
e6167488d5e8: Preparing
6ca29a0fe698: Preparing
d6a5e629f2b8: Preparing
10c7d94a5e7e: Preparing
79e750730574: Preparing
f57e81d89e60: Preparing
8d3ac3489996: Preparing
f57e81d89e60: Waiting
79e750730574: Waiting
8d3ac3489996: Waiting
10c7d94a5e7e: Layer already exists
6ca29a0fe698: Layer already exists
d6a5e629f2b8: Layer already exists
79e750730574: Layer already exists
f57e81d89e60: Layer already exists
8d3ac3489996: Layer already exists
e6167488d5e8: Pushed
f195af9aac4f: Pushed
35: digest: sha256:8a0457c886ea31c56aa4cb0612b8fe8badaca93a20653e8c811dfa4efcb6928a size: 1997
[Pipeline] }
[Pipeline] // withDockerRegistry
[Pipeline] }
[Pipeline] // withEnv
[Pipeline] }
[Pipeline] // script
[Pipeline] }
[Pipeline] // stage
[Pipeline] stage
[Pipeline] { (install Helm chart)
[Pipeline] sh
+ helm upgrade --install --atomic md-sa2-18-21 --namespace default ./helm-chart --values ./helm-chart/values.yaml --set image.tag=35
Error: UPGRADE FAILED: release md-sa2-18-21 failed, and has been rolled back due to atomic being set: post-upgrade hooks failed: pod md-sa2-18-21-test failed
[Pipeline] }
[Pipeline] // stage
[Pipeline] stage
[Pipeline] { (Declarative: Post Actions)
[Pipeline] deleteDir
[Pipeline] slackSend
Slack Send Pipeline step running, values are - baseUrl: <empty>, teamDomain: sa-itacademy-by, channel: #coolnoti, color: #FF0000, botUser: false, tokenCredentialId: slack, notifyCommitters: false, iconEmoji: <empty>, username: <empty>, timestamp: <empty>
[Pipeline] }
[Pipeline] // stage
[Pipeline] }
[Pipeline] // withEnv
[Pipeline] }
[Pipeline] // withEnv
[Pipeline] }
[Pipeline] // node
[Pipeline] End of Pipeline
ERROR: script returned exit code 1
Finished: FAILURE